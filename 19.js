const input = ' |                                                                                                                                                                                                       , | +-----------------------------------------+         +-----------------------------------+           +-+ +-+     +---------------------------------------------------------+ +-+           +---+       , | |                                         |         |                                   |           | | | |     |                                                         | | |           |   |       , | |                                         |   +-----------------------------------------------------|-|-|-------|---------------------------------------------------------+ | |           |   |       , | |                                         |   |     |                                   |           | | | |     |                                                           | |           |   |       , | |                                         |   |     |                                   +---+       | +-|-----+ | +-----------+             +-+             +---------------|-|-----------+   |       , | |                                         |   |     |                                       |       |   | |   | | |           |             | |             |               | |               |       , | |                                         |   |     |                         +-------------|-------------------|-|-----------------------------------------+       +-------|-|---------+     |       , | |                                         |   |     |                         |             |       |   | |   | | |           |             | |                     |       | |         |     |       , | |                                         |   |     |                         +-------------|-------|-------------------------|-----------------------------------------+   | |         |     |       , | |                                         |   |     |                                       |       |   | |   | | |           |             | |                     |   |   | |         |     |       , | |                 +-----------------------|---------|-----------------------------------------------|---|-----|-|-|-----------|---------------------+   +-------+   |   |   | |   +-----|-+   |       , | |                 |                       |   |     |                                       |       |   | |   | | |           |             | |     |   |       |   |   |   | |   |     | |   |       , | |                 |                       |   |     |                       +-----------------------|---+ |   | | |           |             | |     |   |     +-|-------|---|-----+     | |   |       , | |                 |                       |   |     |                       |               |       |     |   | | |           |             | |     |   |     | |   |   |   | |         | |   |       , | |       +---------|-------------------------------------------------------------------------|-------------------|-|-----------|---------------|---------------|---------------|---------------|-----+ , | |       |         |                       |   |     |                       |               |       |     |   | | |           |             | |     |   |     | |   |   |   | |         | |   |     | , | |       |         |                       |   |     |                       |               |       |     |   | | |           |             | |     |   |     | |   |   |   | |         | |   |     | , | |       |         |                       |   |     |                       |               |       |     |   | | |           |             | |     |   |     | |   |   |   | |         | |   |     | , | |       |         |                 +-----|---------------------------+     |               | +-----|---------|-|-|---------+ |             | | +---|---|---------------+   | |       +-|-----|---+ | , | |       |         |                 |     |   |     |                 |     |               | |     |     |   | | |         | |             | | |   |   |     | |   |       | |       | | |   |   | | , | |       |         +-----------------|---------|-----------------------------------------------|-----|-----------|-------------|-------------|---+   |   |     | |   |       | |       | | |   |   | | , | |       |                           |     |   |     |                 |     |               | |     |     |   | | |         | |             | |     |   |     | |   |       | |       | | |   |   | | , | |       |                           |     |   |     |                 +-----|---------------|-|-----|---------|---+         | |             +-----------|-----------|-------------+   | | |   |   | | , | |       |                           |     |   |     |                       |               | |     |     |   | |           | |               |     |   |     | |   |       | |   |   | | |   |   | O , | |       |                           |     |   |     |                       |             +-|-------|-----------|-----------|-|-------+       |     |   |     | |   |       | |   |   | | |   |   | | , | |       |                           |     |   |     |                       |             | | |     |     |   | |           | |       |       |     |   |     | |   |       | |   |   | | |   |   | | , | |       |                           |     |   |     |                       |             | | |     |     |   | |           +-+       |       |     |   |     | |   |       | |   |   | | |   |   | | , | |       |                           |     |   |     |                       |             | | |     |     |   | |                     |       |     |   |     | |   |       | |   |   | | |   |   | | , | |       |                           |     |   |     |                       |             | | |     | +-------|-|---------------------|---+ +-----+ |   |     | |   |       | |   |   | | |   |   | | , | |       |                           |     |   |     |                       |             | | |     | |   |   | |                     |   | | |   | |   |     | |   |       | |   |   | | |   |   | | , | +---------+                         |     |   +-----|-----------------------|-------------|-|-------|-|---|-----|-+   +-+ +-+ +-------|-+ | | |   | |   |     | |   |       | |   |   | | |   |   | | , |         | |                         |     |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |       | |   |   | | |   |   | | , |         | |                         |     |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |   +-----|-------|-|-|---|-+ | | , |         | |                         |     |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |   |   | |   |   | | |   | | | | , |         | |                         |     |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |   |   | |   |   | | |   | | | | , |         | |                         |     |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |   |   | |   |   | | |   | | | | , |         | |                         +-----|---------------------------------------------------|-----|-----|---|-|K--------|---|-------|-----|-----|-------------|-------|---|-+   |   | | |   | | | | , |         | |                               |         |                       |             | | |     | |   |   | | |   | | | | |       | | | | |   | |   |     | |   |   |   |     |   | | |   | | | | , |         | |       +-----------------------|-----------------------------------------------|---|-----|-|-------|---+   | | | | |       | +-----------|---|-----|-|-----+ |   | +---|-+ | | |   | | | | , |         | |       |                       |         |                       |             | | |     | |   |   | |     | | | | |       |   | | |   | |   |     | |   | | |   | |   | | | | |   | | | | , |         | +-------|---------------------------------|-------------------------------------|---------|-|-------|-|-----------|-|-----+ | +---+ |   | |   |     | |   | | |   | |   | | | | |   | | | | , |         |         |                       |         |                       |             | | |     | |   |   | |     | | | | |     | | | |   |   | |   |     | |   | | |   | |   | | | | |   | | | | , |         |         |                       | +---------------------------------------------------------|---|---|-------|---|-|-|---------|-|-----+ +-|-----------|---|---|---|-|-------|---------+ | | , |         |         |                       | |       |                       |             | | |     | |   |   | |     | | | | |     | | | |   | |   |   |     | |   | | |   | |   | | | | |   |   | | , |         |         |                 +-+   | |       | +---------------------------------------|-----|-|---|-----------|---|---|-----|-|-|-|---|-+   |   |     | |   | | |   | |   | | | | |   |   | | , |         |         |                 | |   | |       | |                     |             | | |     | |   |   | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | | | | |   |   | | , |         |         |         +---------|---|-|-------|---------+             |             | | |     | |   | +---|---------|-|---------|---|-------------------------|-|-----|-|---|-|-+ | |   |   | | , |         |         |         |       | |   | |       | |       |             |             | | |     | |   | | | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |         |     +-----------------------------|-----------+     |             |             | | |     | |   | | | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |         |     |   |         |       | |   | |       | | |     |             |             | | |     | |   | | | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |     +-----------+ | +-+     |       | |   | |       | | |     |             |             | | |     | |   | | | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | | | | |     |       | |   | |       | | |     |             |             | | |     | |   | | | |     | | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | | | | |     |       | |   | |       | | |     |             +-------------+ +-|-----------|-|---------+ | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | | | | |     |       | |   | |       | | |     |                               |     | |   | | | |       | | | |     | | | |   |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | | | | |     |       | |   | |       | | |     |                               |     | |   | | | |       | | | |     | +-----+ |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | | | | |     |       | |   | |       | | |     |                               |     | |   | | | |       | | | |     |   | | | |     |   |     | |   | | |   | |   | |   | |   |   | | , |     |   |     | +-----|-------------|-|---|---------------------------------------+           |     | |   | | | |       | | | | +---|-----|-------------|-----|-----|-|-------|---------|-+   | +-|-+ , |     |   |     |   | | |     |       | |   | |       | | |     |                   |           |     | |   | | | |       | | | | |   |   | | | |     |   |     | |   | | |   | |   | |   |     | | |   , |     |   |     | +-|---|-------------|-----|-|-----------|-------------------------|-----------|-------|---------|-----------|---|---------|-|-------|-----------|-------|---|-------------+   | | |   , |     |   |     | | | | |     |       | |   | |       | | |     |                   |           |     | |   | | | |       | | | | |   |   | | | |     |   |     | |   | | |   | |   | |   | |   | | |   , |     |   |     | | | | |     |       | |   | |       | | |     |                   |           |     | |   | | | |   +-----|---|-|-------------|-----|---|-----|---+ | | +---|-|---|-----------|---|-+ , |     |   |     | | | | |     |       | |   | |       | | |     |                   |           |     | |   | | | |   |   | | | | |   |   | | | |     |   |     | | | | |     | |   | |   | |   | | | | , | +-----------------|-|-|-------------|-|---+ |       | | |     |           +-------|-------+   |     | |   | | | |   |   | | | | |   |   | | | |     |   |     | | | | |     | |   | |   | |   | | | | , | |   |   |     | | | | |     |       | |     |       | | |     |           |       |       |   |     | |   | | | |   |   | | | | |   |   | | | |     |   |     | | | | |     | |   | |   | |   | | | | , | |   |   |     | | | | |     |       | |     |       | | |     |           |       |       |   |     | |   | | | |   |   | | | | |   |   | | | |     |   |     | | | | |     | +-----------------|-|-+ , | |   |   |     | | | | W     |       | |     |       | | |     |           |       |       |   |     | |   | | | |   |   | | | | |   |   | | | |     |   |     | | | | |     |     | |   | |   | | |   , | |   |   |     | | | | |     |       | |     |     +---|-------|-------------------|-+     |   |     | |   | | | |   |   | | | | |   | +-|-|-|-----------------|---|-+ +-----|---+ | |   | |   | | |   , | |   |   |     | | | | |     |       | |     |     | | | |     |           |       | |     |   |     | |   | | | |   |   | | | | |   | | | | | |     |   |     | | |         |   | | |   | |   | | |   , | |   |   |     | | | | |     |       | |     |     | | | |     |           |       | |     |   |     | |   | | +-----|-----|-----|-----|-|-|---+     |   |     | | | +-+     |   | | |   | |   | | |   , | |   |   |     | | | | |     |       | |     |     | | | |     |           |       | |     |   |     | |   | |   |   |   | | | | |   | | | | |       |   |     | | | | |     |   | | |   | |   | | |   , | |   |   |     | | | | |     |     +-|-|-----|-------|-|-----------------------------|---+ |   |     | |   | |   +---|---|-|-|-|-----|-|-|-|-|-----------|--R--|---+ | |     |   +-|-+   | |   | | |   , | |   |   |     | | | | |     |     | | |     |     | | | |     |           |       | |   | |   |     | |   | |       |   | | | | |   | | | | |       |   |     | |   | |     |     |     | |   | | |   , | |   +---------|-------------|---------------|-----|-|-|-------------------+       | |   | |   |     | |   | |       |   | | | | |   | | | | |       |   |     | |   | |     |   +-+ +---|---+ | | |   , | |       |     | | | | |     |     | | |     |     | | | |     |                   | |   | |   |     | |   | |       |   | | | | |   | | | | |       |   |     | |   | |     |   |   |   | | | | | |   , | |       |     | | | | |     |     | | |     |     | | | |     |                   +-|---------------|-|---|-|-------------|-|-|-----|-|-|-----------|---------+ |   | |     |   |   |   | | | | | |   , | |       |     | | | | |     |     | | |     |     | | | |     |                     |   | |   |     | |   | |       |   | | | | |   | | | | |       |   |       |   | |     |   |   |   | | | | | |   , | |       |     | | | | |     |     | | +-----------------------|---------------------|---|-----|-----|-------|-------|---|-----|-----|---|-|---------|-+ |       |   | |     +---+   |   | | | | | |   , | |       |     | | | | |     |     | |       |     | | | |     |                     |   | |   |     | |   | |       |   | | | | |   | | | | |       | | |       |   | |             |   | | | | | |   , | | +-----|---------|-----------------|-------|-----|-|---|-----|---------------------------|---|-------------|-----------------|-|-----------|-----+ | | |       |   | |             |   | | | | | |   , | | |     |     | | | | |     |     | |       |     | | | |     |                     |   | |   |     | |   | |       |   | | | | |   | | | | |     | | | |       |   | |             |   | | | | | |   , | | +---+ |     | | | | |     |     | +-----------+ | | | |     |                     |   | |   |     | |   | |       |   | | | | |   | | | | |     | +-|-|-----------|-|-------+ +-------|-|-----|---+ , | |     | |     | | | | |     |     |         |   | | | | |     |                     |   | |   |     | |   | |       |   | | | | |   | | | | |     |   | |       |   | |       | |   |   | | | | | | | , +-|-------------|-|-|-|-------------|-------------|-------------|-------------------------|-----------|-----------------+ | | | | |   | | | | |     |   | |       |   | |       | |   |   | | | | | | | ,   |     | |     | | | | |     |     |         |   | | | | |     |                     |   | |   |     | |   | |       | | | | | | |   | | | | |     |   | |       |   | |       | |   |   | | | | | | | , +---+   | |     | | | | |     |     |         |   | | | | |     |                     +---------------|-+   | |       | | | | | | |   | | | | |     |   | |       |   | |       | |   |   | | | | | | | , | | |   | |     | | | | |     |     |         |   | | | | |     |                         | |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       | |   |   | | | | | | | , | | |   | |   +---|-----|-----|-----|-+       |   | | | | |     |                     +-----|---|-----|-----|-------------|-----------|-|---|-------------|-------|-------------|-+   |   | | | | | | | , | | |   | |   | | | | | |     |     | |       |   | | | | |     |                     |   | |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       |     |   | | | | | | | , | | |   | |   | | | | | |   +-+     | |       |   | | | | |     |                   +-+   | |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       |     |   | | | | | | | , | | |   | |   | | | | | |   |       | |       |   | | | | |     |                   |     | |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       |     |   | | | | | | | , +---|-----------|-|-|-|-----|-------|---------|---|-|-----|-------------------------|-----+ |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       |     | +-+ | | | | | | ,   | |   | |   | | | | | |   |       | |       |   | | | | |     |                   |       |   |     |     | |       | | | | | | |   | | | | |     |   | |       |   | |       |     | |   | | | | | | ,   | |   | |   | | | | +-----+       | |       |   +-|-----|-----|-------------------|-------|---------|-----|-------------|-------|-----|-----|-----|---|-------------+ |       |     | |   | | | | | | ,   | |   | |   | | | |   |           | |       |     | | | |     |                   |       |   |     |     | |       | | | | | | |   | | | | |     |   | |       E     |       |     | |   | | | | | | ,   | |   | |   | | | |   |           +-|-------------------|-------------------------------------|-----------|-|-------|---|-|-|-------|-----|-|-----|---|---------|-----------+ |     | |   | | | | | | ,   | |   | |   | | | |   |             |       |     | | | |     |                   |       |   |     |     | |       | | | | | | |   | | | | |     |   | |       |     |     | |     | |   | | | | | | , +---------|---|-----------------------|-------------------|---------------------+   |       | +-|-----+     | |       | | | | | | |   | | | | |     |   | +-------|-----|-------|---+ | | +-----|-|---+ , | | |   | |   | | | |   |             |       |     | | | |     |               |   |       | | |           | |       | | | | | | |   | | | | |     |   |         |     |     | |   | | | | | | | | |   , | | +---|-----+ | | |   |             |       |     | | | |     |               |   |       | | |           | |       | | | | | +-----------|-|-----|-------------+     |     | |   | | | | | | | | |   , | |     | |     | | |   |             |       |     | | | |     |               |   |       | | |           | |       | | | | |   |   | | | | |     |   |               |     | |   | | | | | | | | |   , +-----+ | |     | | |   |             |       |     | | | |     |               |   |       | | |   +---------|-------|---|-|-----|---|-----|-|---------|-----------------------|-----|-|-|---|-|---|-+ ,   |   | | |     | | |   |             |       |     | | | |     |               |   |       | | |   |       | |       | | | | |   |   | | | | |     |   |               |     | |   | | | | | | | | | | ,   |   +-|-----------|---|---------------+     |     | | | |     |               |   |       | | |   |       | |       | | | | |   |   | | | | |     |   |               |     | |   | | | | | | | | | | ,   |     | |     | | |   |             | |     |     | | | |     |               |   |       | | |   |       | |       | | | | |   |   | | | | |     |   |               |     | |   | | | | | | | | | | , +---------------|-------|---------------|-+   |     | | | |   +-----------------------------|---|-+ |       | |       | | | | |   |   | | | | |     |   |               +-----|-|-+ | | | | | | | | | | , | |     | |     | | |   |             | | |   |     | | | |   | |               |   |       | | | | |       | |       | | | | |   |   | | | | |     |   |                     | | | | | | | | | | | | | , | |     | +-----|-------|---------------------|-------|---------|---------------------------|-|-----|-------|-----------|-+ +-----|---|---|---------|---|-+                   | | | | | | | | | | | | | , | |     |       | | |   |             | | |   |     | | | |   | |               |   |       | | | | |       | |       | |     |   |   | | | | |     |   | |                   | | | | | | | | | | | | | , | |     |       | | |   |             | | |   |     | | | +---------------------------------|-|-|-|-|---------|-------|-|-------------|-------|-----|---|---------------------------|---|-+ | | | | | | , | |     |       | | |   |             | | |   |     | | |     | |               |   |       | | | | |       | |       | |     |   |   | | | | |     |   | |                   | | | | | |   | | | | | | , +---+   |       | | |   |             | | |   |     | | |     | |               |   |   +---|-|-|-----------------------------|-------|---|-|-|-----|---|---------+           | | | | | |   | | | | | | ,   | |   |       | | |   |             | | |   |     | | |     | |               |   |   |   | | | | |       | |       | |     |   |   | | | | |     |   | |       |           | | | | | |   | | | | | | ,   | |   | +-------|-------------------|-|-|---------------------|---------------------+ |   | | | +-|-------|-------+ | |     |   |   | | | | |     |   | |       |           | | | | | |   | | | | | | ,   | |   | |     | | |   |             | | |   |     | | |     | |               |   | | |   | | |   |       | |     | | |     |   |   | | | | |     |   | |       |           | | | | | |   | | | | | | ,   +-------|-------|-----|-------------|---|---|-----|-----------|---------------|-----------+ | |   |       | |     | | |     |   |   | | | | |     |   | |       |           | | | | | |   | | +-+ | | ,     |   | |     | | |   |             | | |   |     | | |     | |               |   | | |     | |   |       | |     | | |     |   |   | | | | |     |   | |       |           | | | | | |   | |     | | ,     |   | |     | | |   |             | | |   |     | | |     | |               |   | | |     | |   |       | |     | | |     |   |   | | | | |     |   | |       |           | | | | | |   | |     | | ,     |   | |     | | |   |             | | |   |     | | |     | |               |   | | |     | |   |       | |     | | |     |   |   | | | | |     |   | |       |           | | | | | |   | |     | | , +---|-----|-----|---------------------|-|-------------|-------|-----------------|---|-|-|-------|-----------------------|-----|---|---+ | | | |     |   | |       |           | | | | | |   | |     | | , |   |   | |     | | |   |             | | |   |     | | |     | |               |   | | |     | |   |       | |     | | |     |   |     | | | |     |   | |       |           | | | | | |   | |     | | , |   |   | |     | | |   |             | | |   |     | +-|-------|---------------|-----|---+ +---|---|-------|-------|---|-----|---|-----|-+ | |     |   | |       |           | | | | | |   | |     | | , |   |   | |     | | |   |             | | |   |     |   |     | |               |   | | | | | | |   |       | |     | | |     |   |     |   | |     |   | |       |           | | | | | |   | |     | | , |   |   | |   +-----|-------------------|-|-------+ |   |     | |   +---------------|---|-|-|-|-----|-------|-------|---|-----|---|---------|-------------|-------------+   +-----|---|-|-+ | |     | | , |   |   | |   | | | |   |             | | |   |   | |   |     | |   |           |   | | | | | | |   |       | |     | | |     |   |     |   | |     |   | |       |     |   | | | | | | | | | |     | | , |   |   | |   | | | |   +-----------+ +---|-------|-+   |     | |   |           +---|-|-----|---------------|-------|---|---------|-----------------|---+ |     +-|-+   |   | | | | | | | | | |     | | , |   |   | |   | | | |               |   | |   |   |     |     | |   |               | | | | | | |   |       | |     | | |     |   |     |   | |     |     |     | | |   |   | | | | | | | | | |     | | , |   |   | |   | | | |               |   | |   |   | +---|-----------|-----------+   | | | | | | |   |       | |     | | |     |   |     |   | |     |     |     | | |   |   +-|---|-----+ | | |     | | , |   |   | |   | | | |               |   | |   |   | |   |     | |   |           |   | | | | | | |   |       | |     | | |     |   |     |   | |     |     |     | | |   |     | | | | |   | | |     | | , |   |   | |   | | | |               +---|-|---|---------|-----|-----------------+   | | | | | | |   |       | |     | | |     |   |     |   | |     |     |     | | |   |     | | | | |   | | |     | | , |   |   | |   | | | |                   | |   |   | |   |     | |   |               | | | | | | |   |       | |     | | |     |   |     |   | |     |     |     | | |   |     | | | | |   | | |     | | , | +-|-+ | |   | | | |                   | +-------------------|-----------------------|-----|-|-|-------------|---+ | | | +---|---------------|-----------|-----|-------------|-----|-+   | | |     | | , | | | | | |   | | | |                   |     |   | |   |     | |   |               | | | | | | |   |       | |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | |     | | |     | | , | | | | | |   | | | |                   +-----|---------------|-+   |               | | | | | | |   |       | |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | |     | | |     | | , | | | | | |   | | | |                         |   | |   |     |     |               | | | | | | |   |       | |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | |     | | |     | | , | | | | | |   | | | |                         |   | |   |     |     |               | | | | | | |   |       | |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | |     | | |     | | , | | | | | |   | | | |                         |   | |   |     |     |               | | | | | | |   |       | |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | |     | | |     | | , | | | | | |   | | | |                         |   | |   +-----|---------------------------|-|-|-----|-------+ |   | | | | |   |   |     |   | |     |     |     | | |   |     | | | +-+   | | |     | | , | | | | | |   | | | |                         |   | |         |     |               | | | | | | |   |         |   | | | | |   |   |     |   | |     |     |     | | |   |     | | |   |   | | |     | | , | | | | | |   | | | |                         |   | |         |     |               | | | | | | | +-|-------------|-|-----+   |   |     |   | |     |     |     | | |   |     | | |   |   | | |     | | , | | | | | |   | | | |                         |   | |         |     |               | | | | | | | | |         |   | | | |     |   |     |   | |     |     |     | | |   |     | | |   |   | | |     | | , | | | | | |   | | | |                         |   | |         |     |               | | | | | | | | |         |   | | | |     |   |     |   | |     |     |     | | |   |     | | |   |   | | |     | | , | | | | | |   | | | |                         |   | |         |     |               | | | | | | | | |         |   | | | |     |   |     |   | |     |     |     | | |   |     | | |   |   | | |     | | , | | | | | |   | | | |                         |   | +---------|-----|---------------|-|-|-------|-----------------+ | | |     |   |     |   | |     |     |     | | +---|---+ | | | B +---|-|-|-+   | | , | | | | | |   | | | |                         |   |           |     |               | | | | | | | | |         |     | | |     |   |     |   | |     |     |     | |     |   | | | | |     | | | |   | | , | | | | | |   | | | |                         |   |           |     |               | | | | | | | | |         |     | | |     |   | +---+   | |     |     |     | |     |   | | | | +-+   | | | |   | | , | | | | | |   | | | |                         |   |           |     |               | | | | | | | | |         |     | | |     |   | |       | |     |     |     | |     |   | | | |   |   | | | |   | | , | | | | | |   +-|-|-------------+             |   |           |     |               +-+ | +---|-|---|-------------+ | | |     |   | |       | |     |     |     | | +-------|-----|---|-+ | | | |   | | , | | | | | |     | | |           |             |   |           |     |                   |   | | | | |         |   | | | |     |   | |       | |     |     |     | | |   |   | | | |   | | | | | |   | | , | | | | | |     | | |           |             |   |   +-------+     |                   |   | | | | |       +-|---|---|-|-----------|---------------|---+ | +-------|-----------|-----|-|-------|-+ | | , | | | | | |     | | |           |             |   |   |             |                   |   | | | | |       | |   | | | |     |   | |       | |     |   | | |   | | |   |   | | | |   | | | | | | | | | , | | | | | |     | | |           |             |   |   |             |                   |   | | +-|-|-------|-|---|---|-|---------|-+       | |     |   +-|---+ | +-+   |   | | | +---+ +-+ | | | | | | , | | | | | |     | | |           |             |   |   |             |                   |   | |   | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |           | | | | | | , | | +-|---|-----+ | |           |             |   |   |             |                   |   | |   | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |           | | | | | | , | |   | | |       | |           |             |   |   |             |                   |   | |   | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |           | | | | | | , | |   | | |       | |           +---------+   |   |   |             |           +---------------------------|-----|-|---|-----|---|---------|-|-------------------------|-----|---------+   | | | | | | , | |   | | |       | |                     |   |   |   |             |           |       |   | |   | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |       |   | | | | | | , | |   | | |       | |                     |   |   |   +-------------+   +-------|-----------|-+   | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |       |   | | | | | | , | |   | | |       | |                     |   |   |                     |       |       |   |     | |       | |   | | | |     |   |         | |     |     | | | |       |   | | |       |   | | | | | | , +-+   | +-|-+     | +---+                 |   |   |                     |       |       |   |     | |       | +---|---+ |     |   |         | |     |   +-+ | +-|-------|---|-------------------+ | +-+ ,       |   | |     |     |                 |   |   |                     |       |       |   |     | |       |     | |   |     |   |         | |     |   |   |   |       |   | | |       |   | |   |     ,       |   | |     +---+ +-------------------------|---------------------|-------------------------|-|-------|-----|-----+     |   |         | |     |   |   |   |       |   | | |       |   | |   |     ,       |   | |         |                   |   |   |                     |       |       |   |     | |       |     | |         |   |         | |     |   |   |   |       |   | | |       |   | |   |     ,       |   +-----------------------+       | +-+   |               +-+   |       |       +---|-------|-------|-------|---------|---|---------|-|-----|-+ |   |   |       |   | | |       |   | |   |     ,       |     |         |           |       | |     |               | |   |       |           |     | |       |     | |         |   |         | |     | | |   |   |       |   | | |       |   | |   |     ,   +---------+         |           +-------|-----------------------+ +-----------------------|-----|-----------+   | |         |   +-----------|-----------------------+ |   | | |       |   | |   +---+ ,   |   |               |                   | |     |                     |       |           |     | |       | |   | |         |             | |     | | |   |   |     | |   | | |       |   | |       | ,   |   |               |                   | +--N------------------------|-------------------|-----+ |       | +---|-|-+       |             | |     | | |   |   |     | |   | | |       |   | |       | ,   |   |               |                   |       |                     |       |           |       |       |     | | |       |             | |     | | |   |   |     | |   | | |       |   | |       | ,   |   |               |         +-----------------|---------------+ +-----------|-----------+ +-------------|-----|---+       +-------------|-|-----|---|---+   |     | |   | | |       |   | |       | ,   |   |               |         |         |       |               | |   |       |             |     |       |     | |                       | |     | | |       |     | |   | | |       |   | |       | , +---------------------+         | +---------------+     +-----+   | |   |       |             |     |       |     | |                       | |     | | |       |     | |   | | |       |   | |       | , | |   |                         | |       |             |     |   | |   |       |             |     |       |     | |                       | |     | | |       |     | |   | | |       |   | |       | , | |   |                         | |       |             +-----|-----|---|-----------------------------------+     | |                       | |     | | |       |     | |   | | |       |   | |       | , | |   |                         | |       |                   |   | |   |       |             |     |             | |                       | |     | | |       |     | |   | | |       |   | |       | , +-|-----+                       +-+       |                   |   | +---|-------|-------------+     |             | |                       +-|--------L--------------+ |   | | |       |   | |       | ,   |   | |                                 |                   |   |     |       |                   |             | |                         |     | | |       |       |   | | |       |   | |       | ,   |   | |                                 |                   |   |     +---------------------------|---------------|-------------------------------+ | |       |       |   +---+       |   | |       | ,   |   | |                                 |                   |   |             |                   |             | |                         |       | |       |       |     |         |   | |       | ,   |   | |                                 |                   |   |             |                   +-----------------------------------------|-------|-----------------|---+ |         |   | | +---+ | ,   |   | |                                 |                   |   |             |                                 | |                         |       | |       |       |   | |         |   | | |   | | ,   |   | |                                 |                   |   |             |                                 | |                         |       | |       |       |   | |         |   | | |   | | ,   |   | |                                 |                   |   |             |                                 | |                         |       | |       |       |   | |         |   | | |   | | ,   |   | +---------------------------------|-----------------------|-------------------------------------------------+                         |       | |       |       |   | |         +-----|-----+ | ,   |   |                                   |                   |   |             |                                 |                           |       | |       |       |   | |             | | |     | ,   |   |             +---------------------------------------------+             |                                 |                           |       | |       |       |   +---------------+ +---+   | ,   |   |             |                     |                   |                 |                                 |                           |       | |       |       |     |                 | |   | , +-+   |             |                     |                   |                 |                                 |                           |       | |       |     +-------------------------+ +---+ , |     |             |                     |                   |                 |                                 |                           |       | |       |     | |     |                         , |     +-------------------------------------------------------|-----------------|---------------------------------|---------------------------|-------|---------|-----+ |     |                         , |                   |                     |                   |                 |                                 |                           |       | |       |       |     |                         , |                   +-----------------------------------------+                 |         +-----------------------|---------------------------+       | |       |       |     |                         , |                                         |                                     |         |                       |                                   | |       |       |     |                         , |                                         |   +---------------------------------|-------------+                   |         +---------------------------+       |       |     |                         , |                                         |   |                                 |         |   |                   |         |                         |         |       |     |                         , +-----------------------------------------+   +---------------------------------|---------|-+ |                   |         +---------+               |         |       |     |                         ,                                                                                 |         | | |                   |                   |               |         |       |     |                         , +--------Y----------------------------------------------------------------------|-----------|-|-------------------------------------------------------|---------|-------+     |                         , |                                                                               |         | | |                   |                   |               |         |             |                         , +-------------------------------------------------------------------------------+         +-+ +-------------------+                   +---------------+         +-------------+                         ,                                                                                                                                                                                                         '


function readPlumbingMessage(input) {
  const maze = input.split(',').map(line => line.split(''))
  let pos = { x: 0, y: 0 }
  let dir = { x: 0, y: 1 }
  let msg = ''
  let steps = 1

  function get() { return maze[pos.y][pos.x] }
  function move() { pos.x += dir.x; pos.y += dir.y; return get() }
  function redirect() {
    if (dir.x !== 0) {
      dir.x = 0
      dir.y = (maze[pos.y - 1][pos.x] === ' ' ? 1 : -1)
    } else {
      dir.x = (maze[pos.y][pos.x - 1] === ' ' ? 1 : -1)
      dir.y = 0
    }
  }

  // Find entry point
  for (let x = 0; x < maze[0].length; x += 1) {
    pos.x = x
    if (get() === '|') { break }
  }

  while (true) {
    switch (move()) {
      case '+':
        redirect()
        break
      case '|':
      case '-':
        // Just continue
        break
      case ' ':
        return { msg, steps }
      default:
        msg += get()
        break
    }
    steps += 1
  }
}

if (require.main === module) {
  const { msg, steps } = readPlumbingMessage(input)
  console.log('Part 1 (plumbing message):', msg)
  console.log('Part 2 (steps walked):', steps)
}

module.exports = {
  readPlumbingMessage,
}
